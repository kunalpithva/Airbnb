<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Airbnb | Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: #9ca3af;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
      }
      /* Card Effects */
      .card-hover:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }
      .card-hover .card-image {
        transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      .card-hover:hover .card-image {
        transform: scale(1.08);
      }
      .card-hover {
        transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.4s ease;
      }
      /* Button Effects */
      .btn-hover-effect:hover {
        transform: scale(1.02);
      }
      .btn-hover-effect {
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800 antialiased">

    <%- include('../partials/header') %>
    <%- include('../partials/profile') %>
    <!-- Backdrop -->
  <div id="backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
    


    <section class="relative bg-white shadow-md">
      <div class="container mx-auto px-4 py-10 text-center">
        <h2 class="text-4xl md:text-5xl font-extrabold text-rose-600 tracking-tight leading-tight">
          Find your next getaway ‚ú®
        </h2>
        <p class="text-lg md:text-xl text-gray-600 mt-3">
          Explore homes, cabins, and unique places to stay
        </p>
      </div>
    </section>

    <main class="max-w-7xl mx-auto px-4 py-16">
      <form
        action="/home-list"
        method="GET"
        class="flex flex-col md:flex-row items-center gap-4 mb-6 w-full max-w-xl mx-auto px-4"
      >
        <div class="relative flex-grow w-full md:w-auto">
          <input
            type="text"
            name="location"
            placeholder="Search by location..."
            value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>"
            class="w-full rounded-lg border border-gray-300 bg-white py-3 pl-4 pr-12 text-gray-700 placeholder-gray-400 shadow-sm 
                  focus:outline-none focus:ring-2 focus:ring-rose-400 focus:border-rose-400 transition duration-300 ease-in-out"
            aria-label="Search by location"
          />
          <button 
            type="submit" 
            class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-md text-rose-500 hover:text-rose-600 focus:outline-none focus:ring-2 focus:ring-rose-400"
            aria-label="Submit search"
          >
            <i class="fas fa-search fa-lg"></i>
          </button>
        </div>
        <button
          type="submit"
          class="hidden md:inline-flex bg-rose-500 hover:bg-rose-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-rose-300"
        >
          Search
        </button>
      </form>
      <h3 class="text-3xl font-bold mb-12 text-gray-900 tracking-tight">üè° Places to Stay</h3>

      <div class="grid gap-8 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        

        <% registerHome.forEach(home => { %>
          <% if (home) { %>
            <div class="bg-white rounded-2xl overflow-hidden shadow-lg card-hover group border border-gray-200">
              <a href="/homes/<%= home._id %>" class="block">
                <div class="relative h-48 overflow-hidden rounded-t-2xl">
                  <img
                    src="<%= home.photoUrl %>"
                    alt="<%= home.houseName %>"
                    class="w-full h-full object-cover card-image"
                    onerror="this.onerror=null;this.src='https://placehold.co/800x600/E0E0E0/333333?text=No+Image';"
                  />
                  <span class="absolute top-3 right-3 bg-white/80 backdrop-blur-md px-3 py-1 rounded-full text-sm font-semibold text-gray-700 shadow">
                    <i class="fas fa-star text-yellow-500"></i> <%= home.rating %>
                  </span>
                </div>
              </a>

              <div class="p-5 space-y-3">
                <a href="/homes/<%= home._id %>" class="block">
                  <h4 class="text-lg font-bold text-gray-900 truncate hover:text-rose-600"><%= home.houseName %></h4>
                </a>
                <div class="space-y-1 text-gray-600">
                  <p class="flex items-center gap-2 text-sm">
                    <i class="fas fa-map-marker-alt text-rose-500"></i> <%= home.location %>
                  </p>
                  <p class="flex items-center gap-2 text-sm">
                    <i class="fas fa-dollar-sign text-green-600"></i>
                    <span class="font-bold text-gray-900 text-base"><%= home.price %></span> / night
                  </p>
                </div>

                <div class="pt-4 space-y-3">
                  <a href="/homes/<%= home._id %>"
                     class="flex items-center justify-center gap-2 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 rounded-xl btn-hover-effect">
                    <i class="fas fa-info-circle"></i> View Details
                  </a>

                  <% if (isLoggedIn && user.userType !== 'host') { %>
                    <% if (home.isBooked && !home.isBookableAgain) { %>
                      <button
                        class="w-full bg-gray-300 text-gray-600 font-semibold py-2.5 rounded-xl shadow-inner cursor-not-allowed">
                        üö´ Already Booked
                      </button>
                    <% } else { %>
                      <form action="/booking" method="POST">
                        <input type="hidden" name="homeId" value="<%= home._id %>">
                        <button
                          type="submit"
                          class="w-full bg-rose-600 hover:bg-rose-700 text-white font-semibold py-2.5 rounded-xl btn-hover-effect">
                          üè° Book Now
                        </button>
                      </form>
                    <% } %>
                  <% } else if (!isLoggedIn) { %>
                    <form action="/login" method="GET">
                      <button
                        type="submit"
                        class="w-full bg-rose-600 hover:bg-rose-700 text-white font-semibold py-2.5 rounded-xl btn-hover-effect">
                        <i class="fas fa-lock"></i> Login to Book
                      </button>
                    </form>
                  <% } %>
                </div>
              </div>
            </div>
          <% } %>
        <% }) %>
      </div>
    </main>

    <footer class="bg-white border-t mt-16 shadow-inner">
      <div class="max-w-7xl mx-auto p-6 text-center text-gray-500 text-sm">
        ¬© <%= new Date().getFullYear() %> Airbnb Clone. All rights reserved.
      </div>
    </footer>
  </body>
</html>