<!DOCTYPE html>
<html lang="en" class="scroll-smooth" >
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Airbnb | My Bookings</title>
  <link rel="stylesheet" href="/output.css" />
</head>
<body class="flex flex-col min-h-screen bg-gray-50 text-gray-800 font-sans">

  <!-- Navbar -->
  <%- include('../partials/header', { isLoggedIn: isLoggedIn, user: user, currentPage: 'payment' }) %>


  <!-- Page Content -->
  <main class="flex-grow max-w-7xl mx-auto px-4 py-10">
    <h2 class="text-3xl font-bold mb-6">My Bookings</h2>

    <% if (bookings.length > 0) { %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <% bookings.forEach(booking => { %>
          <div
            class="bg-white rounded-2xl border border-gray-200 shadow-sm hover:shadow-lg transition-all duration-200 overflow-hidden group"
          >
            <a href="/homes/<%= booking.home._id %>" class="block">
              <img
                src="<%= booking.home.photoUrl %>"
                alt="<%= booking.home.houseName %>"
                class="w-full h-48 object-cover rounded-t-2xl group-hover:scale-105 transition-transform duration-300"
                onerror="this.onerror=null;this.src='https://placehold.co/800x600/E0E0E0/333333?text=Image+Not+Found';"
              />
            </a>

            <div class="p-4 space-y-2">
              <h4 class="text-lg font-semibold text-gray-900 truncate">
                <%= booking.home.houseName %>
              </h4>
              <p class="text-sm text-gray-500 flex items-center gap-1">
                <i class="fas fa-map-marker-alt text-rose-500"></i> üìç
                <%= booking.home.location %>
              </p>
              <p class="text-sm text-gray-500 flex items-center gap-1">
                <i class="fas fa-dollar-sign text-green-600"></i> üí∞
                $<%= booking.home.price %> / night
              </p>
              <p class="text-sm text-yellow-500 font-semibold flex items-center gap-1">
                <i class="fas fa-star"></i> ‚≠ê
                <%= booking.home.rating %> / 5
              </p>

              <p class="text-sm text-gray-400 mt-1">
                Booked on: <%= booking.bookedAt.toLocaleDateString() %>
              </p>


              <form action="/booking/cancel" method="POST" class="mt-4 flex gap-2">
              <% if (isLoggedIn && user.userType !== 'host') { %>
                <input type="hidden" name="homeId" value="<%= booking.home._id %>" />
                
                <button
                  type="submit"
                  class="flex-1 bg-red-600 hover:bg-red-700 text-white text-sm font-medium py-2 px-4 rounded-xl shadow transition duration-200"
                >
                  ‚ùå Cancel Booking
                </button>
              </form>

              
               
               <!-- <form id="paymentForm" action="/payment/booking/pay/<%= booking.home._id %>" method="POST">
                  <input type="hidden" name="bookingId" value="<%= booking._id %>">
                  <input type="text" name="cardNumber" placeholder="Card Number" required
                        class="border rounded px-2 py-1 text-sm w-full mt-2 mb-2" />
                  <button
                    type="submit"
                    class="flex-1 bg-green-600 hover:bg-green-700 text-white text-sm font-medium py-2 px-4 rounded-xl shadow transition duration-200"
                  >
                    üí≥ Pay Now
                  </button>
                </form> -->

                
<% if (booking.isPaid) { %>
  <span class="bg-emerald-500 text-white text-sm font-semibold py-2 px-4 rounded-xl shadow text-center block">
    ‚úÖ Payment Done
  </span>
<% } else { %>
  <a
    href="/payment/booking/pay?homeId=<%= booking.home._id %>&bookingId=<%= booking._id %>"
    class="bg-green-600 hover:bg-green-700 text-white text-sm font-medium py-2 px-4 rounded-xl shadow transition duration-200 text-center block"
  >
    üí≥ Pay Now
  </a>
<% } %>



              <% } %>



            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p class="text-gray-500 text-center text-lg mt-10">
        You have not booked any homes yet.
      </p>
    <% } %>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t">
    <div class="max-w-7xl mx-auto p-4 text-center text-gray-500 text-sm">
      ¬© <%= new Date().getFullYear() %> Airbnb Clone. All rights reserved.
    </div>
  </footer>
</body>
</html>
