<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Airbnb | My Bookings</title>
  <link rel="stylesheet" href="/output.css" />
</head>
<body class="flex flex-col min-h-screen bg-gray-50 text-gray-800 font-sans">

  <!-- Navbar -->
  <%- include('../partials/header', { isLoggedIn: isLoggedIn, user: user, currentPage: 'booked' }) %>

  <!-- Page Content -->
  <main class="flex-grow max-w-7xl mx-auto px-6 py-10">
    <h1 class="text-3xl font-bold text-rose-600 mb-8 text-center">🏠 Your Booked Homes</h1>

    <% if (bookings && bookings.length > 0) { %>
      <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        <% bookings.forEach(booking => { %>
          <div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden group hover:shadow-lg transition-shadow duration-200">
            <a href="/homes/<%= booking.home._id %>" class="block">
              <img 
                src="<%= booking.home.photoUrl || booking.home.image %>" 
                alt="<%= booking.home.houseName || booking.home.title %>" 
                class="w-full h-48 object-cover rounded-t-2xl group-hover:scale-105 transition-transform duration-300"
                onerror="this.onerror=null;this.src='https://placehold.co/800x600/E0E0E0/333333?text=Image+Not+Found';"
              />
            </a>

            <div class="p-4 space-y-2">
              <h2 class="text-lg font-semibold truncate">
                <%= booking.home.houseName || booking.home.title %>
              </h2>
              <p class="text-sm text-gray-600 flex items-center gap-1">
                📍 <%= booking.home.location %>
              </p>
              <p class="text-sm text-rose-600 font-bold">
                ₹<%= booking.home.price %> / night
              </p>

              <% if (booking.home.bedrooms !== undefined && booking.home.bathrooms !== undefined) { %>
                <p class="text-sm text-gray-500">
                  🛏️ <%= booking.home.bedrooms %> Beds · 🛁 <%= booking.home.bathrooms %> Baths
                </p>
              <% } %>

              <% if (booking.home.rating) { %>
                <p class="text-sm text-yellow-500 font-semibold flex items-center gap-1">
                  ⭐ <%= booking.home.rating %> / 5
                </p>
              <% } %>

              <p class="text-xs text-gray-400">
                Booked on: <%= new Date(booking.bookedAt).toLocaleDateString() %>
              </p>

              <% if (isLoggedIn && user.userType !== 'host') { %>
                <% if (!booking.isPaid) { %>
  <form action="/booking/cancel" method="POST" class="mt-4 flex gap-2">
    <input type="hidden" name="homeId" value="<%= booking.home._id %>" />
    <button
      type="submit"
      class="flex-1 bg-red-600 hover:bg-red-700 text-white text-sm font-medium py-2 px-4 rounded-xl shadow transition duration-200"
    >
      ❌ Cancel Booking
    </button>
  </form>
<% } %>


                <% if (booking.isPaid) { %>
                  <span
                    class="block bg-emerald-500 text-white text-sm font-semibold py-2 px-4 rounded-xl shadow text-center mt-3"
                  >
                    ✅ Payment Done
                  </span>
                <% } else { %>
                  <a
                    href="/payment/booking/pay?homeId=<%= booking.home._id %>&bookingId=<%= booking._id %>"
                    class="block bg-green-600 hover:bg-green-700 text-white text-sm font-medium py-2 px-4 rounded-xl shadow transition duration-200 text-center mt-3"
                  >
                    💳 Pay Now
                  </a>
                <% } %>
              <% } %>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p class="text-gray-500 text-center text-lg mt-20">
        😕 You haven’t booked any homes yet.<br />
        <a href="/home-list" class="text-rose-500 hover:text-rose-600 font-semibold underline mt-4 inline-block">Browse Homes</a>
      </p>
    <% } %>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t mt-16">
    <div class="max-w-7xl mx-auto p-6 text-center text-gray-500 text-sm">
      © <%= new Date().getFullYear() %> Airbnb Clone. All rights reserved.
    </div>
  </footer>

</body>
</html>
